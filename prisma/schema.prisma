generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())

  records     NutritionRecord[]
  weeklyStats WeeklyStats[]
}

model Food {
  id          String @id @default(cuid())
  name        String
  category    String
  caloriesPer100g Int
  proteinPer100g  Float
  carbsPer100g    Float
  fatPer100g      Float

  records     NutritionRecord[]

  createdAt   DateTime @default(now())

  @@unique([name, category])
}

model NutritionRecord {
  id          String   @id @default(cuid())
  name        String?  // 食物名稱（直接輸入時使用）
  category    String   // "蛋白質", "蔬果與纖維", "碳水化合物", "其他"

  // 營養素數值（直接儲存或從Food計算而來）
  calories    Float
  protein     Float    // in grams
  carbs       Float    // in grams
  fat         Float    // in grams

  // 傳統食物記錄欄位（可選）
  foodId      String?  // 可選，關聯到 Food
  amount      Int?     // 克數，僅在有 foodId 時使用

  recordedAt  DateTime @default(now())

  userId      String
  user        User @relation(fields: [userId], references: [id], onDelete: Cascade)
  food        Food? @relation(fields: [foodId], references: [id], onDelete: SetNull)
}


model WeeklyStats {
  id                String @id @default(cuid())
  weekStartDate     DateTime // Monday of the week
  totalCalories     Int
  avgDailyCalories  Float
  totalProtein      Float
  totalCarbs        Float
  totalFat          Float
  avgProtein        Float
  avgCarbs          Float
  avgFat            Float
  recordsCount      Int

  userId            String
  user              User @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@unique([userId, weekStartDate])
}

model GlobalFood {
  id              String    @id
  name            String
  category        String?
  brand           String?
  servingUnit     String?
  servingSize     Float?
  caloriesPer100g Int?
  proteinPer100g  Float?
  carbsPer100g    Float?
  fatPer100g      Float?
  isPublished     Boolean   @default(false)
  updatedAt       DateTime  @default(now()) @updatedAt

  @@map("global_foods")
}
